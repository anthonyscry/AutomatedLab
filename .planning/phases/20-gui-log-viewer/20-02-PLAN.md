---
phase: 20-gui-log-viewer
plan: 02
type: execute
wave: 2
depends_on: ["20-01"]
files_modified:
  - Tests/GuiLogViewer.Tests.ps1
autonomous: true
requirements: [LOGV-01, LOGV-02, LOGV-03]

must_haves:
  truths:
    - "Tests verify LogsView.xaml contains all required named elements for run history"
    - "Tests verify Initialize-LogsView source wires Get-LabRunHistory, filter logic, and export logic"
    - "Tests verify export handler builds correct tab-separated format"
  artifacts:
    - path: "Tests/GuiLogViewer.Tests.ps1"
      provides: "Pester 5.x tests for GUI log viewer XAML and source wiring"
      min_lines: 60
  key_links:
    - from: "Tests/GuiLogViewer.Tests.ps1"
      to: "GUI/Views/LogsView.xaml"
      via: "raw string matching for element names"
      pattern: "LogsView.xaml"
    - from: "Tests/GuiLogViewer.Tests.ps1"
      to: "GUI/Start-OpenCodeLabGUI.ps1"
      via: "source content analysis"
      pattern: "Start-OpenCodeLabGUI.ps1"
---

<objective>
Create Pester tests validating the GUI log viewer XAML structure and source wiring for run history display, filtering, and export.

Purpose: Regression safety net confirming all three LOGV requirements are structurally implemented.
Output: Tests/GuiLogViewer.Tests.ps1 with XAML element tests, source wiring tests, and filter/export logic tests.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-gui-log-viewer/20-01-SUMMARY.md
@GUI/Views/LogsView.xaml
@GUI/Start-OpenCodeLabGUI.ps1
@Tests/DashboardEnhancements.Tests.ps1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Pester tests for GUI log viewer XAML and source wiring</name>
  <files>Tests/GuiLogViewer.Tests.ps1</files>
  <action>
Create Tests/GuiLogViewer.Tests.ps1 following the established pattern from Tests/DashboardEnhancements.Tests.ps1 (raw string matching for XAML, source content analysis for wiring).

Structure the test file with Pester 5.x syntax:

**BeforeAll block:**
- Set $RepoRoot using Split-Path
- Load XAML content: `$LogsViewXaml = Get-Content -Path (Join-Path $RepoRoot 'GUI/Views/LogsView.xaml') -Raw`
- Load source content: `$GuiSource = Get-Content -Path (Join-Path $RepoRoot 'GUI/Start-OpenCodeLabGUI.ps1') -Raw`

**Describe "LogsView.xaml — Run History Elements" (LOGV-01):**
Test that XAML raw string contains each required element:
- `x:Name="runHistoryGrid"` — the DataGrid for run history display
- `x:Name="cmbRunHistoryFilter"` — action type filter ComboBox
- `x:Name="btnRefreshHistory"` — refresh button
- `x:Name="btnExportHistory"` — export button
- `x:Name="txtNoHistory"` — empty state message
- `DataGrid` element tag present
- `Run History` header text present

**Describe "LogsView.xaml — Session Log Elements Preserved":**
Test that existing elements are still present:
- `x:Name="cmbLogFilter"`
- `x:Name="btnClearLogs"`
- `x:Name="logScroller"`
- `x:Name="txtLogOutput"`
- `Session Log` or `Logs` header text present

**Describe "LogsView.xaml — DataGrid Columns" (LOGV-01):**
Test that XAML contains column definitions for key fields:
- `RunId` binding/header
- `Action` binding/header
- `Success` binding/header
- `EndedUtc` or `Ended` header

**Describe "Initialize-LogsView — Run History Wiring" (LOGV-01):**
Test that source contains:
- `Get-LabRunHistory` call
- `FindName.*runHistoryGrid` or `FindName('runHistoryGrid')`
- `FindName.*cmbRunHistoryFilter` or `FindName('cmbRunHistoryFilter')`
- `FindName.*btnExportHistory` or `FindName('btnExportHistory')`

**Describe "Initialize-LogsView — Filter Logic" (LOGV-02):**
Test that source contains:
- `cmbRunHistoryFilter` wired with SelectionChanged or similar event
- Filter values 'deploy', 'teardown', 'snapshot' present in source
- `.Action` property reference (used in filter comparison)

**Describe "Initialize-LogsView — Export Logic" (LOGV-03):**
Test that source contains:
- `SaveFileDialog` or `SaveFileDialog` reference
- `Set-Content` or `Out-File` for writing export
- `btnExportHistory` wired with Add_Click
- Tab character or delimiter pattern for export format ("`t" or "Tab")
- `.txt` file filter reference

Each test should use `$LogsViewXaml | Should -Match 'pattern'` for XAML and `$GuiSource | Should -Match 'pattern'` for source. Use `-Match` for regex and `-BeLike` for wildcard patterns as appropriate.

Target: ~20-25 tests total covering LOGV-01, LOGV-02, LOGV-03.
  </action>
  <verify>Run `pwsh -Command "Invoke-Pester -Path Tests/GuiLogViewer.Tests.ps1 -PassThru" 2>&1` from the repo root. All tests must pass.</verify>
  <done>GuiLogViewer.Tests.ps1 passes all tests, covering XAML structure (LOGV-01), filter wiring (LOGV-02), and export wiring (LOGV-03).</done>
</task>

</tasks>

<verification>
1. Tests/GuiLogViewer.Tests.ps1 exists with Pester 5.x Describe/It blocks
2. All tests pass when run with Invoke-Pester
3. Tests cover all three LOGV requirements: panel display, filtering, export
</verification>

<success_criteria>
- GuiLogViewer.Tests.ps1 has 20+ passing tests
- XAML element tests confirm all named controls exist
- Source wiring tests confirm Get-LabRunHistory call, filter logic, and export logic
- No test failures
</success_criteria>

<output>
After completion, create `.planning/phases/20-gui-log-viewer/20-02-SUMMARY.md`
</output>
