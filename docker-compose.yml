services:
  test:
    build: .
    volumes:
      - .:/app:ro
      - ./Tests/results:/app/Tests/results
    command: >
      pwsh -NoProfile -Command
      "New-Item -Path ./Tests/results -ItemType Directory -Force | Out-Null;
       Invoke-Pester -Path ./Tests -OutputFormat JUnitXml -OutputPath ./Tests/results/testResults.xml -Output Detailed;
       exit $$LASTEXITCODE"

  validate:
    build: .
    volumes:
      - .:/app:ro
    command: >
      pwsh -NoProfile -File ./Scripts/Test-LabPreDeploy.ps1
